name: HPC CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:

    runs-on: ubuntu-latest
    container:
      image: quay.io/singularity/singularity:v3.7.0
      options: --privileged

    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: /bin/bash .github/workflows/setup.sh
      - name: Build image and send files
        env:
          RECIPE: ${{ secrets.RECIPE }}
          COLLECTION_CONTAINER: /home/joao/singularity/CFDEM/CFDEM.simg
          RCLONE_CONF: W2Nsb3VkXQp0eXBlID0gZHJpdmUKY2xpZW50X2lkID0gODc5NzQ2NDYzNzg1LTRyamRwanZlZTdvcDU5Z2s3ZnFpcjFiaXZ2aTg3NmU3LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tCmNsaWVudF9zZWNyZXQgPSBHT0NTUFgtUlVjLVR2RWpuYVFTR1ppem9uMFk5NzdTOEFQagpzY29wZSA9IGRyaXZlCnRva2VuID0geyJhY2Nlc3NfdG9rZW4iOiJ5YTI5LkEwQVJyZGFNX2pMX09tQnZCdUZ1TzNjMnRHM1Jtbl9GSS1IZnFmS2FJTEl3eDhXb0tKeng4YV82bHB5LWQ3VEg3YlNaLThRYzc3UndpS2dNUU9oclI0Mk9rc0hpUnFqYlNFR2FWYl9PZkNNUTJFYVowSFBNc2ZDSXQwYUpNMjJldnd2SzJpQzIweXByWGlmUzlnejllUkhHeThKeEF4IiwidG9rZW5fdHlwZSI6IkJlYXJlciIsInJlZnJlc2hfdG9rZW4iOiIxLy8waDRQZTJVOVo2eGdrQ2dZSUFSQUFHQkVTTndGLUw5SXJOckNNNWVaZzk3N0xGU0JVVUlKeUFMUmVXYlpQMmRfS3l3aDdKZnh5RThnNmxldEVtQzhRcDluZG1IVEo1a3FiUHJ3IiwiZXhwaXJ5IjoiMjAyMi0wMy0yMlQxNToxMjoyNS4yNzEyNTYxOS0wMzowMCJ9CnRlYW1fZHJpdmUgPSAKCg==
        run: /bin/bash .github/workflows/send.sh
